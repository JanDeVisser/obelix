%
name: simple_expr
prefix: script_parse_
init: init
ignore_ws: true
%

program                     := statements 
                             ;

statements                  := statement
                               statements 
                             | 
                             ;

statement                   := 'i' 
                               assignment_or_call
                             ;

assignment_or_call         := assignment
                            | func_call
                            ;

assignment                 := 'i'             [ done: push_last_token ] 
                               ":="
                               expr            [ done: emit_assign     ]
                             ;

expr                        := term
                               termtail
                             ;

termtail                    := add_op
                               term            [ done: emit_mathop     ]
                               termtail
                             | 
                             ;

term                        := factor factortail 
                             ;

factortail                  := mult_op
                               factor          [ done: emit_mathop     ]
                               factortail
                             | 
                             ;

factor                      := ( expr ) 
                             | 'i'         [ done: emit_pushvar   ]
                             | 'd'         [ done: emit_pushval   ]
                             ;

add_op                      := +           [ done: push_last_token ]
                             | -           [ done: push_last_token ]
                             ;

mult_op                     := *           [ done: push_last_token ]
                             | /           [ done: push_last_token ]
                             | ^           [ done: push_last_token ]
                             | %           [ done: push_last_token ]
                             ;

func_call                   := (           [ done: init_param_count ]
                               parlist
                               )           [ done: emit_func_call  ]
                             ;

parlist                     := param
                               parlist_tail
                             ;

param                       := expr        [ done: param_count     ] 
                             ;

parlist_tail                := ,
                               parlist
                             |
                             ;
 
