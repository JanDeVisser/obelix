func ctx(name)
  self.name = name
  
  func __enter__()
    print("__enter__ ${0}", self.name)
  end

  func __exit__(ex)
    print("__exit__ ${0}", self.name)
    if ex
      print("__catch__ ${0}: ${1}", self.name, ex.msg)
      if ex.hasattr("rethrow")
        if ex.rethrow
	  print("rethrow!")
	  ex.rethrow = false
          throw ex
	end
      end
      print("not rethrown")
    end
  end

  print("new ${0}", self.name)
end

context c1 = new ctx("c1")
  context c2 = new ctx("c2")
    context c3 = new ctx("c3")
      throw { msg: "test error", rethrow: true }
    end
  end
end
